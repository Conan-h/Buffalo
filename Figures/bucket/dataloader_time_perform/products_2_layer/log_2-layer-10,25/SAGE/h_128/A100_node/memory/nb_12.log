python3 bucky_time.py --num-batch 12
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
/home/shuangyan/.local/lib/python3.10/site-packages/pynvml/smi.py:5: FutureWarning: The pynvml.smi module is deprecated and will be removed in the next release of pynvml. Please use pynvml_utils:
(e.g. `from pynvml_utils import nvidia_smi`)
  warnings.warn(
main start at this time 1728775061.7243304
-----------------------------------------before load data 
 Nvidia-smi: 0.85455322265625 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.85455322265625 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

load pickle file time  0.43520569801330566
generate_dataloader_bucket_block=======
the output layer 
self.num_batch (get_in_degree_bucketing) 12
get_in_degree_bucketing dst global nid length 196571
len(bkt)  173
len(bkt)  221
len(bkt)  374
len(bkt)  456
len(bkt)  445
len(bkt)  550
len(bkt)  655
len(bkt)  512
len(bkt)  576
len(bkt)  640
len(bkt)  624
len(bkt)  583
len(bkt)  615
len(bkt)  695
len(bkt)  673
len(bkt)  614
len(bkt)  556
len(bkt)  604
len(bkt)  584
len(bkt)  572
len(bkt)  586
len(bkt)  592
len(bkt)  648
len(bkt)  645
len(bkt)  183378
total indegree bucketing result ,  196571
the number of total output nodes match :) 
local nids of zero in-degree  []
bucket partitioner: bkt_dst_nodes_list_local length  25
---||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||--
self.num_batch,  12
type of fanout_dst_nids  <class 'torch.Tensor'>
sum(estimated_mem)
27.023624836713726
24
the last batch value is  1464
G_BUCKET_ID_list [[11, 3, 2], [19, 13, 0], [23, 8], [14, 9, 7], [17, 10, 4], [6, 5, 1], [16, 12], [22], [21], [20], [18], [15]]
G_BUCKET_ID_list length 12
backpack scheduling spend  0.11175060272216797
len(g_bucket_nids_list)  12
len(local_split_batches_nid_list)  12
current group_mem  1.403347350375729
current group_mem  3.001967961271789
current group_mem  3.0000069573568977
current group_mem  3.0006915325832333
current group_mem  2.9975327611562568
current group_mem  1.0749997896799088
current group_mem  2.939728300182595
current group_mem  2.232189497508864
current group_mem  2.1946883605045633
current group_mem  1.920127067184496
current group_mem  1.793769060001223
current group_mem  1.4645761989081698
batches output list generation spend  0.0004124641418457031
self.weights_list  [0.08493114447197196, 0.08506849942260049, 0.08395439815639133, 0.0870270792741554, 0.08625382177432073, 0.0849972783370894, 0.08370003713670887, 0.08103942087083038, 0.08075453652878603, 0.08072401320642414, 0.08071383876563684, 0.08083593205508442]
bkt_dst_nodes_list = self.get_in_degree_bucketing() spend:  0.01335597038269043
self.gen_batches_seeds_list(bkt_dst_nodes_list_local) spend  0.11243391036987305
self.has_zero_indegree_seeds  False
num_output  196571
self.output_nids  196571
output nodes length match
global output equals  True
partition total batch output list spend :  2.052396297454834
self.buckets_partition() spend  sec:  0.12581634521484375
dataloader gen time  11.54624080657959
step  0
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 1.7049560546875 GB
    Memory Allocated: 0.41681575775146484  GigaBytes
Max Memory Allocated: 0.41681575775146484  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 22.2459716796875 GB
    Memory Allocated: 20.392528533935547  GigaBytes
Max Memory Allocated: 20.765356063842773  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 22.2459716796875 GB
    Memory Allocated: 20.395452976226807  GigaBytes
Max Memory Allocated: 20.765356063842773  GigaBytes

step  1
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 22.2537841796875 GB
    Memory Allocated: 0.4505605697631836  GigaBytes
Max Memory Allocated: 20.765356063842773  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 35.8358154296875 GB
    Memory Allocated: 20.76009225845337  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 35.8358154296875 GB
    Memory Allocated: 20.76340913772583  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

step  2
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 35.8358154296875 GB
    Memory Allocated: 0.4608449935913086  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 35.8416748046875 GB
    Memory Allocated: 20.7544264793396  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 35.8416748046875 GB
    Memory Allocated: 20.75731658935547  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

step  3
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 35.8416748046875 GB
    Memory Allocated: 0.47576284408569336  GigaBytes
Max Memory Allocated: 21.14204740524292  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.837674617767334  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.840670585632324  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  4
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.48546266555786133  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.80476188659668  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.80850315093994  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  5
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.4919314384460449  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.351386070251465  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.354590892791748  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  6
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5069665908813477  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.760035514831543  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.762917041778564  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  7
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5164322853088379  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.64725160598755  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.65013313293457  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  8
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5270943641662598  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.646190643310547  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.648980617523193  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  9
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5387492179870605  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.58513307571411  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.58878803253174  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  10
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5482878684997559  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.562750816345215  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.566001415252686  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

step  11
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5570363998413086  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.461949825286865  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 20.464818477630615  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------after optimizer
 Nvidia-smi: 47.7381591796875 GB
    Memory Allocated: 0.5921311378479004  GigaBytes
Max Memory Allocated: 21.218603134155273  GigaBytes

----------------------------------------------------------pseudo_mini_loss sum 5.2044501304626465
pure train time :  3.5526061058044434
train time :  5.718050956726074
end to end time :  17.26433038711548
end to end time  17.700177907943726
/home/shuangyan/.local/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/shuangyan/.local/lib/python3.10/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
Total (block generation + training)time/epoch nan
Total (block generation + training)time/epoch all [17.700177907943726]
pure train time per /epoch  [3.5526061058044434]
pure train time average  nan
dataloader time  [11.54624080657959]
dataloader time avg per epoch nan

input num list  [12584898]
      backpack schedule time  [2.109621047973633]
------backpack schedule time avg nan
                connection_check_time_list  [6.30754280090332]
------connection_check time avg nan
                block_gen_time_list  [2.565427541732788]
------block gen time avg nan
shuangyan@jrs1:~/Betty_baseline/Figures/bucket/dataloader_time_perform/products_2_layer$ 