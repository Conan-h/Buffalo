python3 bucky_time.py --num-batch 18
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
/home/shuangyan/.local/lib/python3.10/site-packages/pynvml/smi.py:5: FutureWarning: The pynvml.smi module is deprecated and will be removed in the next release of pynvml. Please use pynvml_utils:
(e.g. `from pynvml_utils import nvidia_smi`)
  warnings.warn(
main start at this time 1728773042.0874126
-----------------------------------------before load data 
 Nvidia-smi: 0.85455322265625 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.85455322265625 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

load pickle file time  0.4526245594024658
generate_dataloader_bucket_block=======
the output layer 
self.num_batch (get_in_degree_bucketing) 18
get_in_degree_bucketing dst global nid length 196571
len(bkt)  173
len(bkt)  221
len(bkt)  374
len(bkt)  456
len(bkt)  445
len(bkt)  550
len(bkt)  655
len(bkt)  512
len(bkt)  576
len(bkt)  640
len(bkt)  624
len(bkt)  583
len(bkt)  615
len(bkt)  695
len(bkt)  673
len(bkt)  614
len(bkt)  556
len(bkt)  604
len(bkt)  584
len(bkt)  572
len(bkt)  586
len(bkt)  592
len(bkt)  648
len(bkt)  645
len(bkt)  183378
total indegree bucketing result ,  196571
the number of total output nodes match :) 
local nids of zero in-degree  []
bucket partitioner: bkt_dst_nodes_list_local length  25
---||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||-----||--
self.num_batch,  18
type of fanout_dst_nids  <class 'torch.Tensor'>
sum(estimated_mem)
27.023624836713726
24
the last batch value is  1028
G_BUCKET_ID_list [[22], [6, 5, 3, 1], [21, 0], [23], [13, 9], [14, 7, 2], [10, 8, 4], [20], [18], [19], [16], [17], [15], [12], [11]]
G_BUCKET_ID_list length 15
backpack scheduling spend  0.09528517723083496
len(g_bucket_nids_list)  15
len(local_split_batches_nid_list)  18
current group_mem  2.232189497508864
current group_mem  1.3068242388952873
current group_mem  2.2282285622209037
current group_mem  2.223171411479282
current group_mem  2.2199646769036976
current group_mem  2.2155376024494022
current group_mem  2.1752215580623586
current group_mem  1.920127067184496
current group_mem  1.793769060001223
current group_mem  1.6766132844613435
current group_mem  1.6565154083265854
current group_mem  1.5991467489715145
current group_mem  1.4645761989081698
current group_mem  1.2832128918560093
current group_mem  1.0285266294845892
batches output list generation spend  0.0003707408905029297
self.weights_list  [0.0551251201855818, 0.061402750151344804, 0.05572032497163874, 0.055109858524400854, 0.05862004059601874, 0.05975957796419614, 0.060197078918049964, 0.05480971252117556, 0.05479953808038825, 0.05473849143566447, 0.05465709590936608, 0.05490128248826124, 0.05495215469219773, 0.05495724191259138, 0.054794450859994605, 0.051828601370497177, 0.051828601370497177, 0.05179807804813528]
bkt_dst_nodes_list = self.get_in_degree_bucketing() spend:  0.01264500617980957
self.gen_batches_seeds_list(bkt_dst_nodes_list_local) spend  0.09592914581298828
self.has_zero_indegree_seeds  False
num_output  196571
self.output_nids  196571
output nodes length match
global output equals  True
partition total batch output list spend :  2.951306104660034
self.buckets_partition() spend  sec:  0.10860300064086914
dataloader gen time  11.855810165405273
step  0
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 1.6248779296875 GB
    Memory Allocated: 0.35218381881713867  GigaBytes
Max Memory Allocated: 0.35218381881713867  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 16.6170654296875 GB
    Memory Allocated: 14.976164817810059  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 16.6170654296875 GB
    Memory Allocated: 14.978515625  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

step  1
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 16.6248779296875 GB
    Memory Allocated: 0.37766361236572266  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4061279296875 GB
    Memory Allocated: 14.757701396942139  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 17.4061279296875 GB
    Memory Allocated: 14.760051727294922  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

step  2
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4061279296875 GB
    Memory Allocated: 0.3875088691711426  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 14.959914207458496  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 14.96226453781128  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

step  3
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 0.3951091766357422  GigaBytes
Max Memory Allocated: 15.228755950927734  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 15.020613193511963  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 15.022963523864746  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

step  4
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 0.40596628189086914  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 15.00900411605835  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 15.011354446411133  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

step  5
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 17.4100341796875 GB
    Memory Allocated: 0.4165177345275879  GigaBytes
Max Memory Allocated: 15.275755405426025  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 15.085819244384766  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 15.088169574737549  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  6
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.422576904296875  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 15.013788223266602  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 15.016138553619385  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  7
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.42999982833862305  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.967989921569824  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.969877243041992  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  8
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4352288246154785  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.870436191558838  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.87249231338501  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  9
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4469623565673828  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.915162086486816  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.917046546936035  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  10
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4516291618347168  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.884101390838623  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.886160373687744  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  11
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.45998048782348633  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.8970046043396  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.899354934692383  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  12
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4681715965270996  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.897552490234375  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.899902820587158  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  13
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4742746353149414  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.82010555267334  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.82244062423706  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  14
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.48420095443725586  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.797994136810303  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.800344467163086  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  15
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.4858088493347168  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.50417423248291  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.506113052368164  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  16
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.49088478088378906  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.500037670135498  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.501976490020752  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

step  17
----------------------------------------before batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.49701833724975586  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after batch_pred = model(blocks, batch_inputs)
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.468127727508545  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after loss function
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 14.470297813415527  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------after optimizer
 Nvidia-smi: 18.2440185546875 GB
    Memory Allocated: 0.5190930366516113  GigaBytes
Max Memory Allocated: 15.340445041656494  GigaBytes

----------------------------------------------------------pseudo_mini_loss sum 5.209649562835693
pure train time :  2.6959173679351807
train time :  4.813831329345703
end to end time :  16.669686794281006
end to end time  17.122965335845947
/home/shuangyan/.local/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/shuangyan/.local/lib/python3.10/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
Total (block generation + training)time/epoch nan
Total (block generation + training)time/epoch all [17.122965335845947]
pure train time per /epoch  [2.6959173679351807]
pure train time average  nan
dataloader time  [11.855810165405273]
dataloader time avg per epoch nan

input num list  [15982678]
      backpack schedule time  [3.002993583679199]
------backpack schedule time avg nan
                connection_check_time_list  [5.942981004714966]
------connection_check time avg nan
                block_gen_time_list  [2.3277573585510254]
------block gen time avg nan